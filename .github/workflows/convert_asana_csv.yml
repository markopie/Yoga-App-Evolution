name: Convert Asana JSON to CSV
on:
  workflow_dispatch:

jobs:
  convert:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Pre-process JSON with jq
        run: |
          # Convert the object into a flat array and save to a file
          jq -c 'to_entries | map({id: .key, name: .value.name, note: .value.note})' asana_library.json > processed.json

      - name: Convert JSON to CSV
        uses: austenstone/json-to-csv@main
        id: csv_step
        with:
          # Pointing directly to the file is safer than a variable
          json: ./processed.json

      - name: Create CSV File
        run: |
          echo "${{ steps.csv_step.outputs.csv }}" > asana_tasks.csv

      - name: Upload Result
        uses: actions/upload-artifact@v4
        with:
          name: asana-csv-export
          path: asana_tasks.csv
