<!doctype html>
<html lang="en">
   <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>Yoga Sequences</title>
      <link rel="stylesheet" href="style.css">
   </head>
   <body>
    <div id="adminContainer" style="display:none; padding: 20px; background: #fff;">
       <div style="margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 10px;">
          <button onclick="toggleAdminUI(false)" style="font-size: 1.2rem;">← Back to App</button>
          <h2 style="display:inline-block; margin-left: 20px;">Sequence Manager</h2>
       </div>
       <div id="adminBulkEditor"></div>
    </div>
    <div id="mainAppContainer">
    <header>
       <div class="row">
          <strong>Yoga Sequences</strong>
          <span class="muted" id="statusText">Loading…</span>
       </div>
       <div class="row" style="margin-top:10px">
          <label class="muted" for="sequenceSelect">Sequence:</label>
          <div style="margin-bottom: 10px;">
             <button type="button" onclick="toggleAdminUI(true)">⚙️ Manage Sequences</button>
          </div>
          <select id="sequenceSelect">
             <option value="">Select a sequence</option>
          </select>
          <button id="browseBtn" type="button" title="Browse / search asanas">Browse</button>
            <span class="pill" id="poseCounter">–</span>
            <span class="pill" id="poseTimer">–</span>
            <span class="pill" id="totalTimePill" title="Estimated total practice time for this sequence">Total: –</span>
            <span class="pill" id="lastCompletedPill" title="Last time you marked this sequence complete">Last: –</span>
            <div class="controls">
               <button id="prevBtn" type="button">◀ Prev</button>
               <button id="nextBtn" type="button">Next ▶</button>
               <button id="startStopBtn" type="button">Start</button>
               <button id="resetBtn" type="button">Reset</button>
               <button id="completeBtn" type="button" style="display:none">✓ Complete</button>
            </div>
         </div>
      </header>
      <main>
         <div class="grid">
            <div class="card">
               <div style="display:flex;justify-content:space-between;gap:10px;align-items:flex-start;flex-wrap:wrap">
                  <div>
                     <div id="poseName" style="font-size:20px;font-weight:700">Select a sequence</div>
                     <div class="muted">
                        <span id="poseMeta"></span>
                        <span id="poseCounter" style="margin-left:8px; font-weight:bold;"></span>
                     </div>
                  </div>
                  <div style="text-align:right">
                     <div class="muted" id="debugSmall"></div>
                     <button id="completeBtn" style="display:none; margin-top:5px;">Complete Sequence</button>
                  </div>
               </div>
               <div style="margin-top:12px" id="collageWrap">
                  <div class="msg" id="loadingText">Select a sequence</div>
               </div>
               <details id="poseNoteDetails" style="margin-top:12px;max-width:720px;">
                  <summary style="cursor:pointer;font-weight:650;">Note</summary>
                  <div id="poseNoteBody" class="muted" style="padding-top:8px;color:#111"></div>
               </details>
               <details id="poseDescDetails" style="margin-top:12px;max-width:720px" open>
                  <summary style="cursor:pointer;font-weight:650">Description</summary>
                  <div id="poseDescBody" class="muted" style="padding-top:8px;color:#111"></div>
               </details>
            </div>
         </div>
         <div>
            <details>
               <summary>Advanced</summary>
               <div class="inner">
                  <div class="adv-section-title">Admin mode</div>
                  <div class="muted" style="margin-top:8px;display:flex;gap:12px;align-items:center;flex-wrap:wrap">
                     <label style="display:flex;gap:8px;align-items:center">
                     <input id="adminModeToggle" type="checkbox">
                     Enable editing (descriptions + categories)
                     </label>
                  </div>
                  <div class="muted" id="adminHint" style="display:none;margin-top:6px">
                     Admin mode enables editing of asana descriptions and category overrides in Browse.
                  </div>
                  <div class="adv-section-title">History of completed sequences</div>
                  <div class="muted" style="margin-top:8px">
                     <a href="#" id="historyLink">History</a>
                  </div>
                  <div id="historyPanel" class="muted" style="display:none;margin-top:6px"></div>
               </div>
            </details>
         </div>
         </div>
      </main>
      <div class="modal-backdrop" id="browseBackdrop" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="browseTitle">
      <div class="modal-header">
         <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <strong id="browseTitle">Browse Asanas</strong>
            <span class="muted" id="browseCount">–</span>
         </div>
         <div style="display:flex;gap:10px;align-items:center">
            <button id="browseCloseBtn" type="button">Close</button>
         </div>
      </div>
      <div class="modal-body">
      <div class="browse-left">
      <div class="browse-filters">
      <div style="display:flex;gap:8px;align-items:center;flex:1;min-width:180px">
         <input id="browseSearch" placeholder="Search name (English or IAST)" style="flex:1">
      </div>
      <input id="browsePlate" class="tiny" placeholder="Plate e.g. 184 or 176-183">
      <input id="browseAsanaNo" class="tiny" placeholder="Asana #">
      <select id="browseCategory">
      <option value="">All categories</option>